<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é‡è®¾ç½®åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .test-data {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ ç›´æ’­éŸ³é‡è®¾ç½®åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-case">
            <div class="test-title">æµ‹è¯•æ¡ˆä¾‹1ï¼šæ­£å¸¸éŸ³é‡æ•°æ®</div>
            <div class="test-data" id="testData1">{
  "pcSpeakerDecibel": -26.93,
  "micDecibleList": "[-58.94,-58.49,-61.68,-59.94,-60.48,-58.71,-60.21,-61.06,-59.94,-60.21,-59.68,-58.94,-60.21,-59.18,-61.06,-54.19,-55.04,-57.44,-57.44,-20.8,-57.64,-12.59,-24.34,-61.37,-59.18,-61.06,-50.57,-8.95,-14.53,-61.37]"
}</div>
            <button onclick="testCase(1)">æµ‹è¯•æ¡ˆä¾‹1</button>
            <div class="result" id="result1"></div>
        </div>
        
        <div class="test-case">
            <div class="test-title">æµ‹è¯•æ¡ˆä¾‹2ï¼šç³»ç»ŸéŸ³é‡é™éŸ³</div>
            <div class="test-data" id="testData2">{
  "pcSpeakerDecibel": -999.0,
  "micDecibleList": "[-58.94,-58.49,-61.68,-59.94,-60.48]"
}</div>
            <button onclick="testCase(2)">æµ‹è¯•æ¡ˆä¾‹2</button>
            <div class="result" id="result2"></div>
        </div>
        
        <div class="test-case">
            <div class="test-title">æµ‹è¯•æ¡ˆä¾‹3ï¼šéº¦å…‹é£éŸ³é‡é™éŸ³</div>
            <div class="test-data" id="testData3">{
  "pcSpeakerDecibel": -15.5,
  "micDecibleList": "[-999,-999,-999,-999,-999]"
}</div>
            <button onclick="testCase(3)">æµ‹è¯•æ¡ˆä¾‹3</button>
            <div class="result" id="result3"></div>
        </div>
        
        <div class="test-case">
            <div class="test-title">æµ‹è¯•æ¡ˆä¾‹4ï¼šåªæœ‰ç³»ç»ŸéŸ³é‡ (ç”¨æˆ·æ¡ˆä¾‹)</div>
            <div class="test-data" id="testData4">{
  "pcSpeakerDecibel": -30.25
}</div>
            <button onclick="testCase(4)">æµ‹è¯•æ¡ˆä¾‹4</button>
            <div class="result" id="result4"></div>
        </div>
        
        <div class="test-case">
            <div class="test-title">æµ‹è¯•æ¡ˆä¾‹5ï¼šåªæœ‰ç³»ç»ŸéŸ³é‡</div>
            <div class="test-data" id="testData5">{
  "pcSpeakerDecibel": -30.25
}</div>
            <button onclick="testCase(5)">æµ‹è¯•æ¡ˆä¾‹5</button>
            <div class="result" id="result5"></div>
        </div>
        
        <div class="test-case">
            <div class="test-title">æµ‹è¯•æ¡ˆä¾‹6ï¼šåªæœ‰éº¦å…‹é£éŸ³é‡</div>
            <div class="test-data" id="testData6">{
  "micDecibleList": "[-45.2,-46.1,-44.8,-45.9,-46.3]"
}</div>
            <button onclick="testCase(6)">æµ‹è¯•æ¡ˆä¾‹6</button>
            <div class="result" id="result6"></div>
        </div>
    </div>

    <script>
        // å¤åˆ¶éŸ³é‡è®¾ç½®å¤„ç†å‡½æ•°
        function generateAudioSettings(data) {
            console.log('ğŸµ å¼€å§‹å¤„ç†éŸ³é‡è®¾ç½®æ•°æ®');
            console.log('ğŸµ pcSpeakerDecibel:', data.pcSpeakerDecibel);
            console.log('ğŸµ micDecibleList:', data.micDecibleList);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰éŸ³é‡ç›¸å…³æ•°æ®
            if (!data.pcSpeakerDecibel && !data.micDecibleList) {
                console.log('ğŸµ æœªæ‰¾åˆ°éŸ³é‡è®¾ç½®æ•°æ®');
                return 'æš‚æ— éŸ³é‡è®¾ç½®æ•°æ®';
            }
            
            let systemVolumeDisplay = 'æ— è¾“å…¥';
            let micVolumeDisplay = 'æ— è¾“å…¥';
            
            // å¤„ç†ç³»ç»ŸéŸ³é‡è®¾ç½®
            if (data.pcSpeakerDecibel !== undefined && data.pcSpeakerDecibel !== null) {
                const systemVolume = parseFloat(data.pcSpeakerDecibel);
                if (systemVolume < -900) {
                    systemVolumeDisplay = 'å®Œå…¨é™éŸ³';
                } else {
                    systemVolumeDisplay = `${systemVolume.toFixed(2)} dB`;
                }
                console.log('ğŸµ ç³»ç»ŸéŸ³é‡å¤„ç†ç»“æœ:', systemVolumeDisplay);
            }
            
            // å¤„ç†éº¦å…‹é£éŸ³é‡è®¾ç½®
            if (data.micDecibleList) {
                try {
                    const micVolumeArray = JSON.parse(data.micDecibleList);
                    console.log('ğŸµ è§£æçš„éº¦å…‹é£éŸ³é‡æ•°ç»„:', micVolumeArray);
                    
                    if (Array.isArray(micVolumeArray) && micVolumeArray.length > 0) {
                        // è®¡ç®—å¹³å‡å€¼
                        const numericValues = micVolumeArray.filter(val => typeof val === 'number' && !isNaN(val));
                        if (numericValues.length > 0) {
                            const average = numericValues.reduce((sum, val) => sum + val, 0) / numericValues.length;
                            
                            if (average < -900) {
                                micVolumeDisplay = 'å®Œå…¨é™éŸ³';
                            } else {
                                micVolumeDisplay = `${average.toFixed(2)} dB (å¹³å‡å€¼)`;
                            }
                            console.log('ğŸµ éº¦å…‹é£éŸ³é‡å¤„ç†ç»“æœ:', micVolumeDisplay, 'æ•°ç»„é•¿åº¦:', numericValues.length);
                        }
                    }
                } catch (e) {
                    console.warn('ğŸµ æ— æ³•è§£æmicDecibleList:', e);
                }
            }
            
            return `
                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border-left: 4px solid #6c757d;">
                    <div style="font-weight: bold; font-size: 16px; color: #495057; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">ğŸµ ç›´æ’­éŸ³é‡è®¾ç½®</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 30px; font-size: 14px; color: #495057;">
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="font-weight: bold; color: #343a40;">ç³»ç»ŸéŸ³é‡è®¾ç½®:</div>
                            <div style="font-weight: bold; color: ${systemVolumeDisplay.includes('é™éŸ³') || systemVolumeDisplay.includes('æ— è¾“å…¥') ? '#dc3545' : '#6c757d'}; font-family: 'Courier New', monospace;">${systemVolumeDisplay}</div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <div style="font-weight: bold; color: #343a40;">éº¦å…‹é£éŸ³é‡è®¾ç½®:</div>
                            <div style="font-weight: bold; color: ${micVolumeDisplay.includes('é™éŸ³') || micVolumeDisplay.includes('æ— è¾“å…¥') ? '#dc3545' : '#6c757d'}; font-family: 'Courier New', monospace;">${micVolumeDisplay}</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function testCase(caseNumber) {
            const testDataElement = document.getElementById(`testData${caseNumber}`);
            const resultElement = document.getElementById(`result${caseNumber}`);
            
            try {
                const data = JSON.parse(testDataElement.textContent);
                const html = generateAudioSettings(data);
                resultElement.innerHTML = html;
                console.log(`æµ‹è¯•æ¡ˆä¾‹${caseNumber}æ‰§è¡Œå®Œæˆ`);
            } catch (error) {
                resultElement.innerHTML = `<div style="color: red;">é”™è¯¯: ${error.message}</div>`;
                console.error(`æµ‹è¯•æ¡ˆä¾‹${caseNumber}æ‰§è¡Œå¤±è´¥:`, error);
            }
        }
    </script>
</body>
</html> 